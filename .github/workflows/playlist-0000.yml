name: Aggiorna Playlist XromTV - Reset 00:00

on:
  schedule:
    # Ora solare (UTC+1): 23:00 UTC = 00:00 ITA
    - cron: '0 23 * 1-3,10-12 *'
    # Ora legale (UTC+2): 22:00 UTC = 00:00 ITA
    - cron: '0 22 * 4-9 *'
  workflow_dispatch:

permissions:
  contents: read

jobs:
  reset-gist:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: Debug - Info esecuzione
        run: |
          echo "ðŸ” ============ DEBUG INFO ============"
          echo "ðŸ“… Data/Ora italiana: $(TZ='Europe/Rome' date '+%Y-%m-%d %H:%M:%S %Z')"
          echo "ðŸŒ Data/Ora UTC: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          echo "âš™ï¸  Trigger: ${{ github.event_name }}"
          echo "======================================"

      - name: Crea M3U vuoto
        run: echo "#EXTM3U" > reset.m3u

      - name: Aggiorna Gist
        uses: exuanbo/actions-deploy-gist@v1
        with:
          token: ${{ secrets.GIST_TOKEN }}
          gist_id: ${{ secrets.GIST_ID }}
          file_path: reset.m3u
          file_type: text

      - name: Riepilogo
        run: |
          echo "### ðŸ“Š Riepilogo Reset" >> $GITHUB_STEP_SUMMARY
          echo "| Ora (Italia) | $(TZ='Europe/Rome' date '+%Y-%m-%d %H:%M:%S') |" >> $GITHUB_STEP_SUMMARY
          echo "| Stato | ${{ job.status == 'success' && 'âœ… OK' || 'âŒ Errore' }} |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**ðŸŒ™ Playlist resettata a mezzanotte**" >> $GITHUB_STEP_SUMMARY
