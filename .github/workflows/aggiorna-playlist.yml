name: Aggiorna Playlist
on:
  schedule:
    # ORA SOLARE (gen-mar, ott-dic): UTC+1 ‚Üí 09:00 italiana = 08:00 UTC
    - cron: '0 8 * 1-3,10-12 *'
    
    # ORA LEGALE (apr-set): UTC+2 ‚Üí 09:00 italiana = 07:00 UTC
    - cron: '0 7 * 4-9 *'
  
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Debug - Info esecuzione
      run: |
        echo "üìã ============ AGGIORNA PLAYLIST ============"
        echo "üìÖ Data/Ora italiana: $(TZ='Europe/Rome' date '+%Y-%m-%d %H:%M:%S %Z')"
        echo "üåç Data/Ora UTC: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
        echo "‚öôÔ∏è  Trigger: ${{ github.event_name }}"
        echo "============================================="
    
    - uses: actions/checkout@v3
    
    - uses: actions/setup-python@v4
      with:
        python-version: "3.11"
    
    - name: Install
      run: |
        pip install playwright requests
        playwright install chromium
    
    - name: Merge
      run: python merge.py
    
    - name: Upload Gist
      env:
        GIST_TOKEN: ${{ secrets.GIST_TOKEN }}
      run: |
        python3 << 'EOF'
        import json
        with open("solo_sky.m3u") as f:
            content = f.read()
        payload = {"files": {"solo_sky.m3u": {"content": content}}}
        with open("gist.json", "w") as f:
            json.dump(payload, f)
        EOF
        
        curl -X PATCH \
          -H "Authorization: token $GIST_TOKEN" \
          -H "Content-Type: application/json" \
          -d @gist.json \
          https://api.github.com/gists/b5a78b8c6e9d6e895c6ccbb030f565a2
    
    - name: Riepilogo
      if: always()
      run: |
        echo "### üìã Riepilogo Aggiornamento Playlist" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "| Parametro | Valore |" >> $GITHUB_STEP_SUMMARY
        echo "|-----------|--------|" >> $GITHUB_STEP_SUMMARY
        echo "| **Ora (Italia)** | $(TZ='Europe/Rome' date '+%Y-%m-%d %H:%M:%S') |" >> $GITHUB_STEP_SUMMARY
        echo "| **Trigger** | ${{ github.event_name == 'workflow_dispatch' && 'üîß Manuale' || '‚è∞ Automatico' }} |" >> $GITHUB_STEP_SUMMARY
        echo "| **Stato** | ${{ job.status == 'success' && '‚úÖ OK' || '‚ùå Errore' }} |" >> $GITHUB_STEP_SUMMARY
```

## Differenze chiave rispetto al tuo workflow originale:

1. **Due cron separati** per ora legale/solare:
   - `'0 8 * 1-3,10-12 *'` ‚Üí gennaio-marzo e ottobre-dicembre (ora solare)
   - `'0 7 * 4-9 *'` ‚Üí aprile-settembre (ora legale)

2. **Rimosso `push:`** - non serve se hai gi√† un altro workflow attivo

3. **Aggiunto step di debug** - cos√¨ vedi sempre quando parte e l'orario

## Test immediato

Esegui manualmente per verificare che funzioni:
```
Actions ‚Üí "Aggiorna Playlist" ‚Üí Run workflow